<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Tables and Chairs</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="format-detection" content="telephone=no" />
<style>
body {
	background-color: white;
	margin-left: 50px;
	font-family: "Open Sans", Helvetica, Arial, sans-serif;
}

.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}

.switch input { 
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked + .slider {
  background-color: #2196F3;
}

input:focus + .slider {
  box-shadow: 0 0 1px #2196F3;
}

input:checked + .slider:before {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(26px);
}

/*for toggle to display 1 and 2 */
.slider .on,
.slider .off {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  color: white;
  font-size: 12px;
  font-weight: bold;
  transition: opacity 0.2s ease-in-out;
}

.slider .off {
  right: 12px;
  opacity: 1;
}

.slider .on {
  left: 12px;
  opacity: 0;
}

input:checked + .slider .on {
  opacity: 1;
}

input:checked + .slider .off {
  opacity: 0;
}

</style>
</head>
<body>

<p>A food court would like to place tables and chairs so that they can maximise the number of chairs in the area below, while ensuring that </p>
<ul>
<li>there is at most one chair or table per square, but nothing on the obstaclles (brown squares and grey squares);</li>
<li>no tables touch (even diagonally); and</li>
<li>a chair must have a table beside it.</li>
</ul>
<p>Click on the grid below to place a table and its chairs. (Click again to remove the table.) How many chairs can you get?</p>
<p>Toggle the switch to allow 2 tables to touch each other </p>

<label class="switch">
	<input type="checkbox", id = "Toggle">
	<span class="slider round">
		<span class="off">1</span>
		<span class="on">2</span>
	</span>
</label>

<div style="text-align: center; margin-bottom: 20px;">
    <label for="layoutSelect">Choose a layout: </label>
    <select id="layoutSelect">
		<option value="1">18x7 grid</option>
        <option value="2">10x5 grid</option>
		<option value="3"> 9x9 grid </option>
        <option value="4">10x10 L grid</option>
    </select>
	<button>Clear Layout</button>
</div>
<canvas id="space" width="800px" height="600px" style="margin-left: auto; margin-right: auto; display: block; cursor: pointer; border: solid 2px;"></canvas>

<div id="score" style="text-align: center; width: 200px; display: block; margin-left: auto; margin-right: auto; font-size: 140%; margin-top: 30px;">
Chairs: 0
</div>

<script>
var canvas = document.getElementById('space');
var context = canvas.getContext('2d');

var grid = [];
var cols, rows, square = 45; 
var x,y;
var layout = [];

// sets the initial grid layout based on selection (defines cols, rows, layout)
function setLayout ( ) {
	var selected = document.getElementById('layoutSelect').value;
  
  	if (selected == "1") {
		grid = [
      "000000000000000000",
      "000000000000000000",
      "000000000000000000",
      "000000000000000000",
      "000000000000000000",
      "000000000000000000",
      "000000001100000000"]; 

	} else if (selected == "2") {
		grid = [
      "0000000000",
      "0000000000",
      "0000000000",
      "0000000000",
      "0000110000"];

	} else if (selected == "3") {
		grid = [
		"200020002",
		"000000000",
		"000000000",
		"000000000",
		"200020002",
		"000000000",
		"000000000",
		"000000000",
		"200020002"];
	} else if (selected == "4") {
		grid = [ 
		"0000000000",
      	"0000000000",
      	"0000000000",
      	"0000000000",
		"0000000000",
      	"0000000000",
		"2222000000",
		"2222000000",
		"2222000000",
		"2222000000"];
	}
  	
	cols = grid[0].length ; 
  	rows = grid.length;
  
  	canvas.width = cols*square;
	canvas.height = rows*square;
  
	layout = [];
	for (y=0; y < rows; y++) { layout.push(new Array(cols).fill(0)); }
	
	for (var i=0; i < rows; i++) {
		for (var j=0; j < cols; j++) {
			if (grid[i][j] == 1) {
				layout[i][j] = 3;
			}
			else if (grid[i][j] == 2) {
				layout[i][j] = 4;
			}
		}
	}
	drawLayout();

 
document.getElementById('layoutSelect').addEventListener('change', setLayout);
}


////button function
function onButtonClick() {
	setLayout(); 
}

const button = document.querySelector('button');
button.addEventListener('click', onButtonClick);
///////////////////////////////

////toggle function
var isToggleOn = false;  // global variable to track toggle state

document.addEventListener('DOMContentLoaded', function() {
	var checkbox = document.querySelector('input[type="checkbox"]');
	checkbox.addEventListener('change', function() {
		isToggleOn = checkbox.checked; //update global variable 
		setLayout(); // redraw the layout when checkbox is toggled
		if (checkbox.checked) {
			// canvas.style.display = 'block';
		} else {
			// canvas.style.display = 'none';
		}
	});
});



// draws grid, tables, chairs, and rubbish bins on the table 
function drawLayout ( ) {
	context.beginPath();
	context.fillStyle = "white";
	context.rect(0,0,canvas.width,canvas.height); // canvas width and height from the top
	context.fill();
	
	var chairs = 0;
	for (y=0; y < rows; y++) {
		for (x=0; x < cols; x++) {
			if (layout[y][x] == 1) { // table
				context.fillStyle = "red";
				context.beginPath();
				context.rect(x*square+5,y*square+5,square-10,square-10);
				context.fill();
			} else if (layout[y][x] == 2) { // chair
				context.fillStyle = "blue";
				context.beginPath();
				context.rect(x*square+15,y*square+15,square-30,square-30);
				context.fill();
				chairs += 1;
			} else if (layout[y][x] == 3) { //bin
				context.fillStyle = "#C19461";
				context.beginPath();
				context.rect(x*square,y*square,square,square);
				context.fill();
			} else if (layout[y][x] == 4) { //pillar (unusable space)
				context.fillStyle = "#b0b0b0";
				context.beginPath();
				context.rect(x*square,y*square,square,square);
				context.fill();
			}
		}
	}
	
	// drawing grid lines 
	for (x=0; x < cols; x++) {
		context.beginPath();
		context.moveTo(x*square,0);
		context.lineTo(x*square,canvas.height);
		context.stroke();
	}
	for (y=0; y < rows; y++) {
		context.beginPath();
		context.moveTo(0,y*square);
		context.lineTo(canvas.width,y*square);
		context.stroke();
	}
	
	// optimal value ?? ----- probably gotta have it connected to python (back-end) to connect 
	// if option 1 selected else if option 2 selected 
	var selected = document.getElementById('layoutSelect').value;
	var optimal;
    
    if (isToggleOn) { // if toggle is on, the optimal values are
        if (selected == "1") {
            optimal = 94;
        } else if (selected == "2") {
            optimal = 35;
        } else if (selected == "3") {
            optimal = 54;
        } else if (selected == "4") {
            optimal = 63;
        } 
    
    } else { // if toggle is off, the optimal values are
        if (selected == "1") {
            optimal = 93;
        } else if (selected == "2") {
            optimal = 35;
        } else if (selected == "3") {
            optimal = 52;
        } else if (selected == "4") {
            optimal = 63;
        } 
    }

    // console.log(chairs)
    // console.log(optimal)

	var rating = ""; 
	if (chairs == optimal) { 
		rating = "Perfect!";
	} else if (chairs >= Math.floor(0.95*optimal)) {
		rating = "Excellent";
	} else if (chairs >= Math.floor(0.9*optimal)) {
		rating = "Good"
	} else if (chairs >= Math.floor(0.8*optimal)) {
		rating = "Average"
	} else {
		rating = "";
	}

	document.getElementById("score").innerHTML = "Chairs: " + chairs + "<br>" + rating;
}

// returns a list of directly adjacent grid coordinates (동서남북)
function adjacent (x,y) {
	var ns = [];
	if (y > 0) { ns.push([x,y-1]); }
	if (y < rows-1) { ns.push([x,y+1]); }
	if (x > 0) { ns.push([x-1,y]); }
	if (x < cols-1) { ns.push([x+1,y]); }
	return ns;
}

// returns all neighbouring grid coordinates including diagonals (so all the grid surrounding i,j)
function neighbours (x,y) {
	var ns = [];
	var dx,dy,x1,y1;
	for (dy=-1; dy <= 1; dy++) {
		for (dx=-1; dx <= 1; dx++) {
			if ((dx != 0) | (dy != 0)) {
				x1 = x+dx; y1 = y+dy;
				if ((x1 >=0) & (x1 < cols) & (y1 >= 0) & (y1 < rows)) {
					ns.push([x1,y1]);
				}
			}
		}
	}
	return ns;
}

function single(x,y) { //whether the table is single or not 
	var ns = adjacent(x,y);
	var j;
	for (j=0; j < ns.length; j++) {
		if (layout[ns[j][1]][ns[j][0]] == 1) { //if there is a table adjacent to it 
			return false;
		}
	}
	return true; 
}

// checks whether the non-table space is a valid space to place a table or not 
function valid (x,y) {

	var j,k,xp,yp; 
	var ns = neighbours(x,y); // neighbouring cells to x,y
	var ns1 = adjacent(x,y); //adjacent cells to x,y 
	var neigh = 0;
	var adj = 0;

    for (j=0; j < ns.length; j++) {
        if (layout[ns[j][1]][ns[j][0]] == 1) { //if there is a table in its neighbouring cells 
            neigh += 1;
        }
    }
    
    for (k=0; k < ns1.length; k++) {
        if (layout[ns1[k][1]][ns1[k][0]] == 1){ //if there is any table in adjacent 
            if (!single(ns1[k][0],ns1[k][1])) {
                return false; 
            } else {
            adj += 1; 
            }
        }
    }

    if (isToggleOn) { // if toggle is on, it is *valid* to place a table next to a table 
        if (neigh == 1 && adj == 1) {
            return true; 

        } else {
        return false; 
        }

    } else { // no tables can exist in the neighbouring cells
        if (neigh == 0 && adj == 0) {
            return true; 
        } else {
            return false;
        }
    }
	
}


// handles user clicks on the canvas to place or remove tables and chairs 
function doMouseDown (event) {
	var j; //new variable is introduced --> j 
	event.preventDefault();

	var rect = canvas.getBoundingClientRect(); // gets the canvas's position and dimension relative to the viewpoint 
	// x and y coordinates of mouse are adjusted relative to the canvas 
	x = event.pageX - rect.left - window.pageXOffset;
	y = event.pageY - rect.top - window.pageYOffset;
	x = Math.floor((x - 0)/square);
	y = Math.floor((y - 0)/square);
	
	//console.log((event.pageX - rect.left - window.pageXOffset) + "," + (event.pageY - rect.top - window.pageYOffset));
	if (layout[y][x] < 3) { // if its not a bin

		if (layout[y][x] > 0) { // if its not emtpy  

			if (layout[y][x] == 1) { // if cell contains a table 
				var ns = adjacent(x,y); //gets the adjacent cells 
				for (j=0; j < ns.length; j++) {
					if (layout[ns[j][1]][ns[j][0]] == 2) { //for that cell with table, check if there's a chair 
						
						// does this chair have another table? -- if so, leave that chair on the grid 
						var another = false;
						var ns2 = adjacent(ns[j][0],ns[j][1]); //gets all the adjacent cells of chairs accordingly 
						for (var k=0; k < ns2.length; k++) {
							if ((ns2[k][1] != y) | (ns2[k][0] != x)) { //if the neighbour is not the current table cell
								if (layout[ns2[k][1]][ns2[k][0]] == 1) { //and if that neighbour of the chair cell is a table
									another = true; //it is true that that chair has another associated table 
								}
							}
						}
						if (!another) { //if that chair does not have any other associated neighbouring table 
							layout[ns[j][1]][ns[j][0]] = 0; //becomes empty 
						}
					}
				}

    			// layout[y][x] = 0; //remove table 
				if (!single(x,y)) { //and if that table is a double table 
					layout[y][x] = 2; //change it to chair 
				}else {
					layout[y][x] = 0;
				}
			}

			else if (layout[y][x] == 2) { // if cell contains a chair 
				// check if that chair position(x,y) is a valid (x,y) to put a table 
				if (valid(x,y)) { //put chairs in its adjacent positions and change chair to table 
					layout[y][x] = 1; //replace that chair with a table 
					var ns = adjacent(x,y) ; 
					for (j=0; j < ns.length; j++) {
						if (layout[ns[j][1]][ns[j][0]] == 0) { //if adjacent cell to (x,y) is empty
							layout[ns[j][1]][ns[j][0]] = 2 //place chairs 
						}
					}
				} 
			}
	
			
		
		// if the cell is empty 	
		} else {
			var ns = neighbours(x,y); //get neighbouring cells 
			possibletable = true;

			for (j=0; j < ns.length; j++) {
				if (layout[ns[j][1]][ns[j][0]] == 1) { //if there is a table in the neighbouring cells 
					possibletable = false; // not possible to put table down 
				}
			}

			if (possibletable) { //if it is possible to put table down 
				var ns = adjacent(x,y); //find adjacent cells 
				for (j=0; j < ns.length; j++) {
    				if (layout[ns[j][1]][ns[j][0]] == 0) { //if the adjacent cell is empty
    					layout[ns[j][1]][ns[j][0]] = 2; //place chairs 
    				}
                }
				layout[y][x] = 1; //place table in the clicked cell 
			}
		}
		drawLayout();
	}
}


canvas.addEventListener( 'mousedown', doMouseDown, false );

setLayout();

</script>

</body>
</html>